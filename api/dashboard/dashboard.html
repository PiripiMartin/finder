<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Internal Dashboard</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                background: #0a0e27;
                background-image: 
                    radial-gradient(at 0% 0%, rgba(120, 119, 198, 0.1) 0px, transparent 50%),
                    radial-gradient(at 100% 100%, rgba(120, 119, 198, 0.1) 0px, transparent 50%);
                min-height: 100vh;
                padding: 20px;
                color: #e0e0e0;
            }
            
            .dashboard-container {
                max-width: 1400px;
                margin: 0 auto;
                background: #1a1f3a;
                border: 1px solid #2a2f4a;
                border-radius: 12px;
                padding: 40px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            }
            
            h1 {
                color: #e0e0e0;
                margin-bottom: 20px;
                font-weight: 600;
                font-size: 32px;
            }
            
            p {
                color: #b0b5c8;
                font-size: 16px;
                line-height: 1.6;
            }
            
            .loading {
                text-align: center;
                padding: 60px 40px;
                color: #8a8fa3;
                font-size: 16px;
            }
            
            .loading p {
                color: #8a8fa3;
            }
        </style>
    </head>
    <body>
        <div id="loadingScreen" class="loading">
            <p>Verifying access...</p>
        </div>
        
        <div id="dashboardContent" class="dashboard-container" style="display: none;">
            <h1>Internal Dashboard</h1>
            <p>Welcome to the internal dashboard.</p>
        </div>
        
        <script>
            const API_BASE = window.location.origin;
            
            async function validateSession() {
                const sessionToken = localStorage.getItem('sessionToken');
                
                if (!sessionToken) {
                    redirectToLogin();
                    return;
                }
                
                try {
                    // Check admin access (this also validates the token)
                    const response = await fetch(`${API_BASE}/api/admin/check`, {
                        headers: {
                            'Authorization': `Bearer ${sessionToken}`
                        }
                    });
                    
                    if (!response.ok) {
                        localStorage.removeItem('sessionToken');
                        redirectToLogin();
                        return;
                    }
                    
                    const data = await response.json();
                    if (!data.isAdmin) {
                        localStorage.removeItem('sessionToken');
                        redirectToLogin();
                        return;
                    }
                    
                    // Session is valid and user is admin - show dashboard
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('dashboardContent').style.display = 'block';
                    
                } catch (error) {
                    console.error('Session validation error:', error);
                    localStorage.removeItem('sessionToken');
                    redirectToLogin();
                }
            }
            
            function redirectToLogin() {
                window.location.href = '/internal-dashboard/login';
            }
            
            // Validate session on page load
            validateSession();
        </script>
    </body>
</html>
